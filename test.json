{
  "StartAt": "TryCreatePipeline",
  "States": {
    "TryCreatePipeline": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sagemaker:createPipeline",
      "Parameters": {
        "PipelineName": "$.pipelineName",
        "PipelineDefinition": "$.pipelineDefinition"
      },
      "Catch": [
        {
          "ErrorEquals": ["ResourceAlreadyExists"],
          "Next": "TriggerPipeline"
        }
      ],
      "Next": "TriggerPipeline"
    },
    "TriggerPipeline": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sagemaker:startPipelineExecution",
      "Parameters": {
        "PipelineName": "$.pipelineName"
      },
      "ResultPath": "$.PipelineExecutionArn",
      "Next": "WaitForPipelineCompletion"
    },
    "WaitForPipelineCompletion": {
      "Type": "Wait",
      "Seconds": 30,
      "Next": "CheckPipelineStatus"
    },
    "CheckPipelineStatus": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sagemaker:describePipelineExecution",
      "Parameters": {
        "PipelineExecutionArn": "$.PipelineExecutionArn"
      },
      "ResultPath": "$.statusDetails",
      "Next": "EvaluatePipelineStatus"
    },
    "EvaluatePipelineStatus": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.statusDetails.PipelineExecutionStatus",
          "StringEquals": "Succeeded",
          "Next": "NotifySuccessLambda"
        },
        {
          "Variable": "$.statusDetails.PipelineExecutionStatus",
          "StringEquals": "Failed",
          "Next": "NotifyFailureLambda"
        }
      ],
      "Default": "WaitForPipelineCompletion"
    },
    "NotifySuccessLambda": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:<region>:<account-id>:function:<success_lambda_function>",
      "Parameters": {
        "Message": "Pipeline executed successfully"
      },
      "End": true
    },
    "NotifyFailureLambda": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:<region>:<account-id>:function:<failure_lambda_function>",
      "Parameters": {
        "Message": "Pipeline execution failed"
      },
      "End": true
    }
  }
}
